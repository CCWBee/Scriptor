/* Quiet, accessible UI */
:root{
  --bg: #ffffff;
  --fg: #0f172a;
  --muted: #64748b;
  --edge: #e5e7eb;
  --ring: #2563eb;
  --accent: #0ea5e9;
  --accent-2: #10b981;
  --warn: #b91c1c;
  --table-odd: #f8fafc;
  --surface: #ffffff;
}

:root[data-theme="light"]{
  --bg: #ffffff;
  --fg: #0f172a;
  --muted: #64748b;
  --edge: #e5e7eb;
  --ring: #2563eb;
  --accent: #0ea5e9;
  --accent-2: #10b981;
  --warn: #b91c1c;
  --table-odd: #f8fafc;
  --surface: #ffffff;
}

:root[data-theme="dark"]{
  --bg: #0b1020;
  --fg: #e5e7eb;
  --muted: #9aa5b1;
  --edge: #1f2937;
  --ring: #60a5fa;
  --accent: #38bdf8;
  --accent-2: #34d399;
  --warn: #ef4444;
  --table-odd: #0f172a;
  --surface: #0c1426;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font:16px/1.6 system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* Ribbon toolbar */
.ribbon{
  position:sticky; top:0; z-index:20;
  border-bottom:1px solid var(--edge);
  background:linear-gradient(to bottom, var(--surface), color-mix(in srgb, var(--surface) 90%, var(--edge) 10%));
}
.ribbon nav{
  display:flex; align-items:center; gap:.25rem;
  padding:.5rem .75rem; max-width:1100px; margin:0 auto;
}
.btn{
  appearance:none; border:1px solid var(--edge); background:#fff0; color:var(--fg);
  padding:.4rem .55rem; border-radius:.5rem; display:inline-flex; align-items:center; gap:.4rem;
  cursor:pointer; user-select:none;
}
.btn[disabled], .btn[aria-disabled="true"]{opacity:.45; cursor:not-allowed}
.btn:focus-visible{outline:2px solid var(--ring); outline-offset:2px}
.btn:hover{background:var(--edge)}
.btn:active{background:var(--edge)}
.btn[aria-pressed="true"]{background:var(--edge)}
@supports (background: color-mix(in srgb, black, white)) {
  .btn:hover{background:color-mix(in srgb, var(--surface) 92%, var(--edge) 8%)}
  .btn:active{background:color-mix(in srgb, var(--surface) 85%, var(--edge) 15%)}
  .btn[aria-pressed="true"]{background:color-mix(in srgb, var(--surface) 92%, var(--edge) 8%)}
  .table-picker .close:hover{background:color-mix(in srgb, var(--surface) 92%, var(--edge) 8%)}
}
.ico{width:18px; height:18px; display:inline-block}
.sep{width:1px; height:26px; background:var(--edge); margin:0 .25rem}
.spacer{flex:1 1 auto}

/* Table picker */
.table-wrap{position:relative}
.table-picker{
  position:absolute; top:2.6rem; left:0; border:1px solid var(--edge); background:var(--surface);
  border-radius:.5rem; box-shadow:0 6px 24px rgba(0,0,0,.12); padding:.5rem; display:none; z-index:50;
}
.table-picker.open{display:block}
.table-picker .grid{
  --size:10;
  display:grid; grid-template-columns:repeat(var(--size), 20px); gap:3px;
}
.table-picker .grid button{
  width:20px; height:20px; border:1px solid var(--edge); background:#fff0; border-radius:3px; padding:0;
}
.table-picker .grid button.active{background:var(--accent); border-color:var(--accent)}
.table-picker .hint{font-size:.8rem; color:var(--muted); padding:.4rem 0 .2rem}
.table-picker .close{
  margin-top:.25rem; width:100%; padding:.3rem; font-size:1rem; border:1px solid var(--edge);
  background:#fff0; border-radius:.4rem; cursor:pointer;
}
.table-picker .close:hover{background:var(--edge)}

/* Chart builder */
.chart-wrap{position:relative}
.chart-builder{
  position:absolute; top:2.6rem; left:0; border:1px solid var(--edge); background:var(--surface);
  border-radius:.5rem; box-shadow:0 6px 24px rgba(0,0,0,.12); padding:.5rem; display:none; z-index:50; width:280px;
}
.chart-builder.open{display:block}
.chart-builder .row{display:flex; align-items:center; gap:.5rem; margin-bottom:.5rem}
.chart-builder .nodes{display:flex; flex-direction:column; gap:.25rem; margin-bottom:.5rem}
.chart-builder .nodes input{padding:.3rem .4rem; border:1px solid var(--edge); border-radius:.3rem}
.chart-builder .add{width:100%; padding:.3rem; margin-bottom:.5rem; border:1px solid var(--edge); background:#fff0; border-radius:.4rem; cursor:pointer}
.chart-builder .add:hover{background:var(--edge)}
.chart-builder .preview{border:1px solid var(--edge); border-radius:.3rem; padding:.4rem; min-height:60px; margin-bottom:.5rem}
.chart-builder .actions{display:flex; justify-content:flex-end; gap:.5rem}

/* Find/replace */
.find-wrap{position:relative}
.find-wrap summary{list-style:none}
.find-wrap summary::-webkit-details-marker{display:none}
.find-dialog{
  position:absolute; top:2.6rem; left:0; border:1px solid var(--edge); background:var(--surface);
  border-radius:.5rem; box-shadow:0 6px 24px rgba(0,0,0,.12); padding:.5rem; z-index:50; width:260px;
}
.find-wrap:not([open]) .find-dialog{display:none}
.find-dialog .row{display:flex; gap:.5rem; margin-bottom:.5rem; align-items:center}
.find-dialog .row input{flex:1; padding:.3rem .4rem; border:1px solid var(--edge); border-radius:.3rem}
.find-dialog .actions{display:flex; justify-content:flex-end; gap:.5rem}

/* Frontmatter editor */
.frontmatter-wrap{position:relative}
.frontmatter-editor{
  position:absolute; top:2.6rem; left:0; border:1px solid var(--edge); background:var(--surface);
  border-radius:.5rem; box-shadow:0 6px 24px rgba(0,0,0,.12); padding:.5rem; display:none; z-index:50; width:260px;
}
.frontmatter-editor.open{display:block}
.frontmatter-editor .row{display:flex; gap:.5rem; margin-bottom:.5rem}
.frontmatter-editor .row input{flex:1; padding:.3rem .4rem; border:1px solid var(--edge); border-radius:.3rem}
.frontmatter-editor .row .add{padding:.3rem .5rem; border:1px solid var(--edge); background:#fff0; border-radius:.3rem; cursor:pointer}
.frontmatter-editor .row .add:hover{background:var(--edge)}
.frontmatter-editor ul{list-style:none; padding:0; margin:0 0 .5rem 0}
.frontmatter-editor li{display:flex; justify-content:space-between; align-items:center; margin-bottom:.25rem}
.frontmatter-editor li button{border:none; background:#fff0; cursor:pointer}
.frontmatter-editor .actions{display:flex; justify-content:flex-end; gap:.5rem}

/* Surface and editors */
.surface{max-width:1100px; margin:1rem auto; padding:0 1rem}
.editor{
  min-height:60vh; padding:1.25rem 1.5rem; border:1px solid var(--edge); border-radius:.75rem;
  background:var(--surface);
  outline: none;
}
.editor:focus-visible{box-shadow:0 0 0 2px var(--ring)}
.editor:empty:before{content:"Drop a .md file here, or use Load"; color:var(--muted)}
.source{
  display:none; width:100%; min-height:70vh; padding:1rem 1.25rem; border:1px solid var(--edge); border-radius:.75rem;
  background:var(--surface); color:var(--fg); font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
}
.source:focus-visible{box-shadow:0 0 0 2px var(--ring)}

#dropZone.dragover .editor{border-color:var(--accent)}
#dropZone.dragover .editor:before{content:"Release to load file"}

/* Content styling */
.editor h1,.editor h2,.editor h3,.editor h4{line-height:1.25; margin:1.2em 0 .6em}
.editor h1{font-size:1.9rem}
.editor h2{font-size:1.6rem}
.editor h3{font-size:1.3rem}
.editor h4{font-size:1.15rem}
.editor p{margin:.6em 0}
.editor p:empty{margin:0; padding:.6em 0}
.editor strong{font-weight:700}
.editor em{font-style:italic}
.editor s{opacity:.9; text-decoration: line-through}
.editor a{color:var(--accent)}
.editor ul, .editor ol{padding-left:1.4rem}
table{
  border-collapse:collapse; width:100%; margin:1rem 0;
  border:1px solid var(--edge); background:var(--surface)
}
th, td{
  border:1px solid var(--edge); padding:.5rem .6rem; vertical-align:top
}
th:not(:last-child), td:not(:last-child){white-space:nowrap; width:1%}
th:last-child, td:last-child{width:100%}
tbody tr:nth-child(odd){background:var(--table-odd)}
.editor td:focus{outline:2px solid var(--accent-2); outline-offset:-2px}

/* Headings block badge when toggled via keyboard hint */
.badge{
  display:inline-block; font-size:.75rem; color:var(--muted); margin-left:.5rem
}

/* Toasts */
.toasts{position:fixed; right:1rem; bottom:1rem; display:flex; flex-direction:column; gap:.5rem; z-index:60}
.toast{
  background:var(--surface); border:1px solid var(--edge); color:var(--fg);
  padding:.5rem .75rem; border-radius:.5rem; box-shadow:0 6px 24px rgba(0,0,0,.12); max-width:340px
}
.toast.warn{border-color:var(--warn)}
.toast.success{border-color:var(--accent-2)}
.toast.fade{opacity:0; transition:opacity .3s ease}

/* High contrast focus vis */
:focus-visible{scroll-margin: 100px}

/* Disable contenteditable outlines on nested cells */
table[contenteditable="false"] td[contenteditable="true"]{caret-color:auto}

/* Shortcuts sidebar */
.shortcuts{
  position:fixed;
  top:3.5rem;
  right:0;
  width:200px;
  height:calc(100% - 3.5rem);
  padding:1rem;
  background:var(--surface);
  border-left:1px solid var(--edge);
  overflow-y:auto;
  font-size:.9rem;
  z-index:40;
  transition:transform .3s;
}
.shortcuts.collapsed{transform:translateX(100%)}
.shortcuts .toggle{
  position:absolute;
  left:-1.5rem;
  top:.5rem;
  padding:.25rem .3rem;
  border:1px solid var(--edge);
  border-right:none;
  background:var(--surface);
  border-radius:.5rem 0 0 .5rem;
  cursor:pointer;
}
.shortcuts.collapsed .toggle{transform:translateX(-100%)}
.shortcuts h2{
  margin-top:0;
  font-size:1rem;
}
.shortcuts ul{list-style:none; margin:0; padding:0}
.shortcuts li{margin:.3rem 0}
.shortcuts kbd{
  background:var(--edge);
  padding:0 .25rem;
  border-radius:3px;
  font-size:.8rem;
}

@media (min-width:900px){
  body:not(.shortcuts-collapsed) #main{margin-right:220px}
}
